{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Hero Sections{% endblock %}

{% block content %}
<section class="content-section space-y-6">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
        <div>
            <h3 class="text-2xl font-bold text-slate-800">Hero Sections</h3>
            <p class="text-slate-500 mt-1">Manage the content for your website's key landing pages.</p>
        </div>
    </div>

    <!-- Cards Grid -->
    <div class="row g-4">
        {% for card in hero_cards %}
        <!-- Card Item -->
        <div class="col-12 col-md-6 col-lg-3">
            <div
                class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden group hover-shadow-lg transition-all duration-300">

                <!-- Media Container -->
                <div class="position-relative bg-light" style="height: 160px;">
                    {% if card.obj.media_type == 'video' %}
                    {% if card.obj.video %}
                    <video src="{{ card.obj.video.url }}" class="w-100 h-100 object-fit-cover"></video>
                    {% else %}
                    <img src="{% static 'assets/images/logo.jpg' %}"
                        class="w-100 h-100 object-fit-cover opacity-50 grayscale">
                    {% endif %}
                    <div
                        class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-black bg-opacity-25">
                        <div class="bg-white bg-opacity-25 rounded-circle d-flex align-items-center justify-content-center"
                            style="width: 32px; height: 32px; backdrop-filter: blur(4px);">
                            <svg class="w-4 h-4 text-white drop-shadow-sm" fill="currentColor" viewBox="0 0 24 24"
                                style="width: 16px; height: 16px;">
                                <path d="M8 5v14l11-7z" />
                            </svg>
                        </div>
                    </div>
                    {% else %}
                    {% if card.obj.image %}
                    <img src="{{ card.obj.image.url }}"
                        class="w-100 h-100 object-fit-cover transform group-hover:scale-105 transition-transform duration-500"
                        onerror="this.onerror=null;this.src='{% static 'assets/images/logo.jpg' %}';">
                    {% else %}
                    <img src="{% static 'assets/images/logo.jpg' %}" class="w-100 h-100 object-fit-cover">
                    {% endif %}

                    <!-- Icon Badge -->
                    <div class="position-absolute top-0 start-0 m-3 d-flex align-items-center justify-content-center text-white rounded-circle bg-black bg-opacity-50"
                        style="width: 32px; height: 32px; backdrop-filter: blur(8px);">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                    </div>
                    {% endif %}

                    <!-- Badge Overlay -->
                    <div class="position-absolute top-0 end-0 m-3">
                        <span
                            class="badge rounded-pill text-uppercase fw-bold shadow-sm px-3 py-2
                            {% if 'Home' in card.badge %}bg-danger{% elif 'Franchise' in card.badge %}bg-success{% elif 'Packages' in card.badge %}bg-warning{% elif 'Contact' in card.badge %}bg-info{% else %}bg-primary{% endif %}"
                            style="font-size: 0.65rem; letter-spacing: 0.05em;">
                            {{ card.badge }}
                        </span>
                    </div>
                </div>

                <!-- Content Container -->
                <div class="card-body p-4 d-flex flex-column">
                    <h4 class="fw-bold text-dark mb-2 lh-sm" style="font-size: 1rem;">{{ card.obj.title }}</h4>
                    <p class="text-secondary small mb-4 flex-grow-1"
                        style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.6;">
                        {{ card.obj.description }}
                    </p>

                    <div class="mt-auto pt-3 border-top border-light-subtle w-100">
                        {% if card.type == 'home' %}
                        <a href="{% url 'home-banner-list' %}"
                            class="btn btn-primary btn-sm w-100 rounded-3 fw-bold d-flex align-items-center justify-content-center gap-2">
                            <i class="bi bi-collection-play"></i>
                            Manage Slides
                        </a>
                        {% else %}
                        <button
                            onclick="openEditModal('{{ card.type }}', '{{ card.obj.title|escapejs }}', '{{ card.obj.description|escapejs }}', '{{ card.obj.media_type }}', '{{ card.badge|escapejs }}')"
                            class="btn btn-primary btn-sm w-100 rounded-3 fw-bold d-flex align-items-center justify-content-center gap-2">
                            <i class="bi bi-pencil-square"></i>
                            Edit Card
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 py-5 text-center text-muted">
            <div class="bg-light rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3"
                style="width: 64px; height: 64px;">
                <i class="bi bi-inbox fs-2 text-secondary"></i>
            </div>
            <h5 class="fw-bold text-dark">No Cards Found</h5>
            <p class="small mb-0">Check back later or configure your initial data.</p>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}

{% block modals %}
<!-- Edit Modal -->
<div class="modal fade" id="editCardModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg rounded-4">
            <!-- Header -->
            <div class="modal-header border-bottom-0 pb-0">
                <div>
                    <h4 class="modal-title fw-bold text-dark">Edit Card Content</h4>
                    <p class="text-secondary small mb-0">Update details for <span id="modalBadgeName"
                            class="fw-bold text-primary"></span></p>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Content -->
            <div class="modal-body p-4">
                <form id="editCardForm" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row g-4">
                        <!-- Left Column: Inputs -->
                        <div class="col-md-6">
                            <div class="vstack gap-3">
                                <div>
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Card
                                        Title</label>
                                    <input type="text" name="title" id="editTitle" required
                                        class="form-control bg-light border-0 rounded-3 py-2">
                                </div>

                                <!-- Hidden Page Name (Visual handled in header) -->
                                <input type="hidden" name="page_name" id="editPageName">

                                <div id="mediaTypeContainer">
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Media
                                        Type</label>
                                    <select name="media_type" id="editMediaType"
                                        class="form-select bg-light border-0 rounded-3 py-2 cursor-pointer">
                                        <option value="image">Image</option>
                                        <option value="video">Video</option>
                                    </select>
                                </div>

                                <div>
                                    <label
                                        class="form-label small fw-bold text-uppercase text-secondary">Description</label>
                                    <textarea name="description" id="editDescription" rows="5" required
                                        class="form-control bg-light border-0 rounded-3 py-2"
                                        style="resize: none;"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Upload -->
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-uppercase text-secondary">Media File</label>
                            <div
                                class="position-relative w-100 h-100 min-h-[200px] border-2 border-dashed border-secondary-subtle rounded-4 bg-light d-flex flex-column align-items-center justify-content-center text-center p-4 hover-bg-gray-50 transition-all cursor-pointer overflow-hidden group">
                                <input type="file" name="file" id="editFile"
                                    class="position-absolute top-0 start-0 w-100 h-100 opacity-0 cursor-pointer z-10"
                                    accept="image/*,video/*">

                                <div class="mb-3">
                                    <i class="bi bi-cloud-arrow-up display-4 text-primary opacity-50"></i>
                                </div>

                                <h6 class="fw-bold text-dark mb-1">Drag & Drop or Click</h6>
                                <p class="small text-secondary mb-3">Support for high-quality images and videos</p>

                                <span
                                    class="btn btn-white border px-4 rounded-pill fw-bold text-primary shadow-sm small">BROWSE
                                    FILES</span>

                                <div id="filePreview" class="mt-3 d-none w-100">
                                    <div
                                        class="bg-white p-2 rounded-3 border shadow-sm d-flex align-items-center gap-3 text-start">
                                        <div class="bg-primary-subtle p-2 rounded text-primary">
                                            <i class="bi bi-file-earmark-image fs-5"></i>
                                        </div>
                                        <div class="overflow-hidden">
                                            <p id="fileNameDisplay" class="small fw-bold text-dark mb-0 text-truncate">
                                                filename.jpg</p>
                                            <p class="small text-success fw-bold mb-0" style="font-size: 10px;">Ready to
                                                upload</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="d-flex justify-content-end gap-3 mt-4 pt-3 border-top">
                        <button type="button" class="btn btn-light text-secondary fw-bold rounded-pill px-4"
                            data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary fw-bold rounded-pill px-5 shadow-sm">Save
                            Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // File input helper
    const editFile = document.getElementById('editFile');
    const fileNameDisplay = document.getElementById('fileNameDisplay');
    const filePreview = document.getElementById('filePreview');
    const mediaTypeContainer = document.getElementById('mediaTypeContainer');

    editFile.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            fileNameDisplay.textContent = e.target.files[0].name;
            filePreview.classList.remove('d-none');
        } else {
            filePreview.classList.add('d-none');
        }
    });

    function openEditModal(type, title, description, mediaType, pageName) {
        // Populate fields
        document.getElementById('editTitle').value = title;
        document.getElementById('editDescription').value = description;
        document.getElementById('editMediaType').value = mediaType || 'image';
        document.getElementById('editPageName').value = pageName;
        document.getElementById('modalBadgeName').textContent = pageName; // Update header text

        // Handle Product Banner and About Banner Specifics
        if (type === 'product_banner') {
            mediaTypeContainer.classList.add('d-none'); // Hide media type selector
            document.getElementById('editCardForm').action = "{% url 'edit-product-banner' %}";
        } else if (type === 'about_banner') {
            mediaTypeContainer.classList.add('d-none'); // Hide media type selector
            document.getElementById('editCardForm').action = "{% url 'edit-about-banner' %}";
        } else if (type === 'sirius_banner') {
            mediaTypeContainer.classList.add('d-none'); // Hide media type selector
            document.getElementById('editCardForm').action = "{% url 'edit-sirius-banner' %}";
        } else if (type === 'dax_detailing_banner') {
            mediaTypeContainer.classList.add('d-none'); // Hide media type selector
            document.getElementById('editCardForm').action = "{% url 'edit-dax-detailing-banner' %}";
        } else if (type === 'dax_solutions_banner') {
            mediaTypeContainer.classList.add('d-none'); // Hide media type selector
            document.getElementById('editCardForm').action = "{% url 'edit-dax-solutions-banner' %}";
        } else if (type === 'advantage_banner') {
            mediaTypeContainer.classList.add('d-none'); // Hide media type selector
            document.getElementById('editCardForm').action = "{% url 'edit-advantage-banner' %}";
        } else {
            mediaTypeContainer.classList.remove('d-none'); // Show media type selector
            document.getElementById('editCardForm').action = `/hero-card/${type}/edit/`;
        }

        // Reset file input display
        document.getElementById('editFile').value = '';
        filePreview.classList.add('d-none');

        // Show Modal
        new bootstrap.Modal(document.getElementById('editCardModal')).show();
    }
</script>
<style>
    .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
</style>
{% endblock %}